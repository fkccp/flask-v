{% extends 'bbs/layout.html' %}
{% from 'macros/_cmt.html' import render_cmt with context %}
{% from 'macros/_forms.html' import render_form %}

{% block bc %}
<a href="{{ url_for('bbs.index') }}">Index page</a> &gt;
<a href="{{ url_for('bbs.index', nodename=X.post.node.name) }}">{{ X.post.node.name }}</a> &gt;
{{ X.post.title }}
{% endblock %}

{% block bbs_main %}
<h2 class="nmnp">{{ X.post.title }}</h2>
<p>
	[<a href="{{ url_for('index', nodename=X.post.node.name) }}">{{ X.post.node.name }}({{ X.post.node.n_post }})</a>]
	{{ X.post.author.name(X.post.is_anony)|safe }} - {{ X.post.ctime|timesince }}
</p>
<div class="pad5">{{ X.post.content }}</div>

{% for append in X.post.appends %}
<div class="b-yellow">
	<p>附言添加于{{ append.ctime|timesince }}</p>
	<p>{{ append.content }}</p>
</div>
{% endfor %}

<span class="left">Liked({{ X.post.n_liked }})
Marked({{ X.post.n_marked }})
</span>

<span class="right">
{% if X.post.author != g.user %}
<form class="left" action="{{ url_for('action', type='like', post_id=X.post.id) }}" method="post">
	{{ X.act_form.hidden_tag() }}
	<input type="submit" value="{% if g.user in  X.post.liker %}Unlike{% else %}Like{% endif %}" />
</form>
<form class="left" action="{{ url_for('action', type='mark', post_id=X.post.id) }}" method="post">
	{{ X.act_form.hidden_tag() }}
	<input type="submit" value="{% if g.user in X.post.marker %}Unmark{% else %}Mark{% endif %}" />
</form>
{% else %}
<a href="{{ url_for('append', post_id=X.post.id) }}">添加附言</a>
{% endif %}
</span>

<hr class="clear">

<div>{{ render_cmt(X.cmt) }}</div>
{% endblock %}


{% from 'macros/_right.html' import right_user with context %}
{% block right %}
{{ right_user(X.post.author) }}
{% endblock %}